# MineKB å¼€å‘æ•™ç¨‹

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-11-05  
**ä½œè€…**: MineKB Team

---

## ç›®å½•

- [ä¸€ã€èƒŒæ™¯ä¿¡æ¯](#ä¸€èƒŒæ™¯ä¿¡æ¯)
- [äºŒã€MineKB çš„æŠ€æœ¯æ¶æ„](#äºŒminekb-çš„æŠ€æœ¯æ¶æ„)
- [ä¸‰ã€å‰ææ¡ä»¶](#ä¸‰å‰ææ¡ä»¶)
- [å››ã€æœ¬åœ°è¿è¡Œ MineKB](#å››æœ¬åœ°è¿è¡Œ-minekb)
- [äº”ã€æ€»ç»“](#äº”æ€»ç»“)

---

## ä¸€ã€èƒŒæ™¯ä¿¡æ¯

### 1.1 é¡¹ç›®ä»‹ç»

MineKBï¼ˆMine Knowledge Baseï¼Œä¸ªäººæ™ºåº“ï¼‰æ˜¯ä¸€æ¬¾åŸºäº **SeekDB 0.0.1.dev4** å¼€å‘çš„æ¡Œé¢åº”ç”¨ç¨‹åºï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·æ„å»ºå’Œç®¡ç†ä¸ªäººçŸ¥è¯†åº“ã€‚å®ƒé‡‡ç”¨ RAGï¼ˆRetrieval-Augmented Generationï¼‰æ¶æ„ï¼Œç»“åˆå‘é‡æ£€ç´¢å’Œå¤§è¯­è¨€æ¨¡å‹æŠ€æœ¯ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡è‡ªç„¶è¯­è¨€å¯¹è¯çš„æ–¹å¼ä¸è‡ªå·±çš„æ–‡æ¡£"äº¤æµ"ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š

- **ğŸ“š å¤šé¡¹ç›®ç®¡ç†**ï¼šæ”¯æŒåˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„çŸ¥è¯†åº“é¡¹ç›®ï¼Œæ¯ä¸ªé¡¹ç›®å¯åŒ…å«å¤šä¸ªæ–‡æ¡£
- **ğŸ“„ æ–‡æ¡£å¤„ç†**ï¼šæ”¯æŒ TXTã€MDã€PDFã€DOCã€DOCXã€RTF ç­‰å¤šç§æ ¼å¼ï¼Œè‡ªåŠ¨è¿›è¡Œæ–‡æœ¬æå–å’Œå‘é‡åŒ–
- **ğŸ” æ™ºèƒ½æ£€ç´¢**ï¼šåŸºäº SeekDB çš„å‘é‡ç´¢å¼•ï¼ˆHNSWï¼‰ï¼Œå®ç°é«˜æ•ˆçš„è¯­ä¹‰æœç´¢
- **ğŸ’¬ å¯¹è¯é—®ç­”**ï¼šé€šè¿‡ AI å¯¹è¯çš„æ–¹å¼æŸ¥è¯¢çŸ¥è¯†åº“ï¼Œè·å¾—åŸºäºæ–‡æ¡£å†…å®¹çš„ç²¾å‡†å›ç­”
- **ğŸ¤ è¯­éŸ³äº¤äº’**ï¼šæ”¯æŒè¯­éŸ³è¾“å…¥æŸ¥è¯¢ï¼Œæå‡ä½¿ç”¨ä½“éªŒ
- **ğŸ” æœ¬åœ°å­˜å‚¨**ï¼šæ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¿æŠ¤éšç§å®‰å…¨

### 1.2 ä¸ºä»€ä¹ˆé€‰æ‹©æ¡Œé¢åº”ç”¨ï¼Ÿ

ç›¸æ¯” Web åº”ç”¨å’Œç§»åŠ¨åº”ç”¨ï¼Œæ¡Œé¢åº”ç”¨å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

| ä¼˜åŠ¿ | è¯´æ˜ |
|-----|------|
| **æ•°æ®éšç§** | æ•°æ®å®Œå…¨å­˜å‚¨åœ¨æœ¬åœ°ï¼Œæ— éœ€ä¸Šä¼ åˆ°äº‘ç«¯ |
| **ç¦»çº¿å¯ç”¨** | ä¸ä¾èµ–ç½‘ç»œè¿æ¥ï¼ˆé™¤ AI å¯¹è¯å¤–ï¼‰ |
| **æ€§èƒ½ä¼˜è¶Š** | å……åˆ†åˆ©ç”¨æœ¬åœ°è®¡ç®—èµ„æºï¼Œå“åº”é€Ÿåº¦å¿« |
| **ç³»ç»Ÿé›†æˆ** | å¯ä»¥ä¸æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ·±åº¦é›†æˆ |
| **è·¨å¹³å°** | åŸºäº Tauriï¼Œä¸€å¥—ä»£ç æ”¯æŒ Windowsã€macOSã€Linux |
| **èµ„æºå ç”¨å°** | Tauri åŸºäºç³»ç»Ÿ WebViewï¼Œæ¯” Electron æ›´è½»é‡ |

### 1.3 ä¸ºä»€ä¹ˆé€‰æ‹© SeekDBï¼Ÿ

SeekDBï¼ˆåŸºäº OceanBase Liteï¼‰æ˜¯ä¸€æ¬¾ AI-Native çš„åµŒå…¥å¼å‘é‡æ•°æ®åº“ï¼Œéå¸¸é€‚åˆç”¨äºå¼€å‘æ¡Œé¢åº”ç”¨ï¼š

#### æ ¸å¿ƒä¼˜åŠ¿

| ç‰¹æ€§ | è¯´æ˜ | å¯¹ MineKB çš„ä»·å€¼ |
|-----|------|-----------------|
| **åµŒå…¥å¼éƒ¨ç½²** | ä½œä¸ºåº“åµŒå…¥åº”ç”¨ï¼Œæ— éœ€ç‹¬ç«‹æœåŠ¡ | ç®€åŒ–éƒ¨ç½²ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ |
| **åŸç”Ÿå‘é‡æ”¯æŒ** | å†…ç½® `vector` ç±»å‹å’Œ HNSW ç´¢å¼• | å‘é‡æ£€ç´¢æ€§èƒ½æå‡ 10-100x |
| **All-in-One** | åŒæ—¶æ”¯æŒ TPï¼ˆäº‹åŠ¡ï¼‰+ APï¼ˆåˆ†æï¼‰+ AIï¼ˆå‘é‡ï¼‰ | ä¸€ä¸ªæ•°æ®åº“æ»¡è¶³æ‰€æœ‰éœ€æ±‚ |
| **è½»é‡çº§** | ç›¸æ¯”ä¸“ç”¨å‘é‡æ•°æ®åº“æ›´è½»é‡ | é™ä½åº”ç”¨ä½“ç§¯å’Œèµ„æºå ç”¨ |
| **SQL æ¥å£** | æ ‡å‡† SQL è¯­æ³• | å¼€å‘å‹å¥½ï¼Œæ˜“äºç»´æŠ¤ |
| **è·¨å¹³å°** | æ”¯æŒ Windowsã€macOSã€Linux | é…åˆ Tauri å®ç°çœŸæ­£è·¨å¹³å° |

#### ä¸å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|-----|------|------|
| **SeekDB** | åµŒå…¥å¼ã€åŸç”Ÿå‘é‡ã€All-in-One | æ–‡æ¡£è¾ƒå°‘ï¼Œç¤¾åŒºå° |
| **SQLite + æ‰‹åŠ¨å‘é‡** | æˆç†Ÿç¨³å®š | æ€§èƒ½å·®ï¼Œéœ€è¦æ‰‹åŠ¨å®ç°å‘é‡æ£€ç´¢ |
| **Chroma/Qdrant** | ä¸“ä¸šå‘é‡æ•°æ®åº“ | éœ€è¦ç‹¬ç«‹éƒ¨ç½²ï¼Œèµ„æºå ç”¨å¤§ |
| **PostgreSQL + pgvector** | åŠŸèƒ½å¼ºå¤§ | é‡é‡çº§ï¼Œä¸é€‚åˆåµŒå…¥å¼åœºæ™¯ |

---

## äºŒã€MineKB çš„æŠ€æœ¯æ¶æ„

### 2.1 æŠ€æœ¯æ¶æ„åˆ†å±‚

MineKB é‡‡ç”¨ç»å…¸çš„åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œä»ä¸‹è‡³ä¸Šåˆ†ä¸ºï¼šæ•°æ®å±‚ã€æœåŠ¡å±‚ã€å‘½ä»¤å±‚ã€å‰ç«¯å±•ç¤ºå±‚ã€‚

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚ Frontend Layer"
        UI[React UI Components]
        State[çŠ¶æ€ç®¡ç† State Management]
    end
    
    subgraph "å‘½ä»¤å±‚ Command Layer - Tauri"
        CMD_Project[é¡¹ç›®ç®¡ç†å‘½ä»¤]
        CMD_Doc[æ–‡æ¡£ç®¡ç†å‘½ä»¤]
        CMD_Chat[å¯¹è¯ç®¡ç†å‘½ä»¤]
        CMD_Speech[è¯­éŸ³è¯†åˆ«å‘½ä»¤]
    end
    
    subgraph "æœåŠ¡å±‚ Service Layer - Rust"
        SVC_Project[é¡¹ç›®æœåŠ¡ ProjectService]
        SVC_Doc[æ–‡æ¡£æœåŠ¡ DocumentService]
        SVC_Embed[å‘é‡åŒ–æœåŠ¡ EmbeddingService]
        SVC_LLM[LLM å®¢æˆ·ç«¯ LLMClient]
        SVC_Conv[å¯¹è¯æœåŠ¡ ConversationService]
        SVC_Speech[è¯­éŸ³æœåŠ¡ SpeechService]
    end
    
    subgraph "æ•°æ®å±‚ Data Layer"
        direction TB
        
        subgraph "SeekDB Adapter - Rust"
            Adapter[SeekDB é€‚é…å™¨]
        end
        
        subgraph "Python Bridge - Subprocess"
            Bridge[seekdb_bridge.py]
        end
        
        subgraph "SeekDB Database"
            DB[(SeekDB<br/>å‘é‡æ•°æ®åº“)]
            Tables[æ•°æ®è¡¨]
            VectorIndex[å‘é‡ç´¢å¼• HNSW]
        end
        
        Adapter -->|JSON Protocol<br/>stdin/stdout| Bridge
        Bridge -->|Python API| DB
        DB --> Tables
        DB --> VectorIndex
    end
    
    subgraph "å¤–éƒ¨æœåŠ¡ External Services"
        DashScope[é˜¿é‡Œäº‘ç™¾ç‚¼ API<br/>Embedding + LLM]
    end
    
    UI --> State
    State --> CMD_Project
    State --> CMD_Doc
    State --> CMD_Chat
    State --> CMD_Speech
    
    CMD_Project --> SVC_Project
    CMD_Doc --> SVC_Doc
    CMD_Chat --> SVC_Conv
    CMD_Speech --> SVC_Speech
    
    SVC_Doc --> SVC_Embed
    SVC_Conv --> SVC_LLM
    
    SVC_Project --> Adapter
    SVC_Doc --> Adapter
    SVC_Embed --> DashScope
    SVC_Conv --> Adapter
    SVC_LLM --> DashScope
    
    style DB fill:#e1f5ff
    style VectorIndex fill:#fff3e0
    style DashScope fill:#f3e5f5
```

#### æ¶æ„å±‚æ¬¡è¯´æ˜

**1. å‰ç«¯å±‚ï¼ˆFrontend Layerï¼‰**

- **æŠ€æœ¯æ ˆ**ï¼šReact 18 + TypeScript + Tailwind CSS
- **ç»„ä»¶**ï¼šProjectPanelï¼ˆé¡¹ç›®é¢æ¿ï¼‰ã€ChatPanelï¼ˆå¯¹è¯é¢æ¿ï¼‰ã€Layoutï¼ˆå¸ƒå±€ï¼‰
- **çŠ¶æ€ç®¡ç†**ï¼šä½¿ç”¨ React Hooks è¿›è¡ŒçŠ¶æ€ç®¡ç†
- **UI åº“**ï¼šåŸºäº Radix UI æ„å»ºæ— éšœç¢ç»„ä»¶

**2. å‘½ä»¤å±‚ï¼ˆCommand Layerï¼‰**

- **æŠ€æœ¯**ï¼šTauri Commandï¼ˆRust å®è‡ªåŠ¨ç”Ÿæˆï¼‰
- **èŒè´£**ï¼šå‰åç«¯é€šä¿¡æ¡¥æ¢ï¼ŒéªŒè¯è¯·æ±‚å‚æ•°ï¼Œè°ƒç”¨æœåŠ¡å±‚
- **å‘½ä»¤åˆ†ç±»**ï¼š
  - é¡¹ç›®ç®¡ç†ï¼šåˆ›å»ºã€åˆ é™¤ã€é‡å‘½åã€åˆ—è¡¨æŸ¥è¯¢
  - æ–‡æ¡£ç®¡ç†ï¼šä¸Šä¼ ã€é¢„æ£€æŸ¥ã€å¤„ç†ã€åˆ é™¤
  - å¯¹è¯ç®¡ç†ï¼šåˆ›å»ºä¼šè¯ã€å‘é€æ¶ˆæ¯ã€è·å–å†å²
  - è¯­éŸ³è¯†åˆ«ï¼šè¯­éŸ³è½¬æ–‡æœ¬

**3. æœåŠ¡å±‚ï¼ˆService Layerï¼‰**

- **æŠ€æœ¯**ï¼šRust + Tokio å¼‚æ­¥è¿è¡Œæ—¶
- **æ ¸å¿ƒæœåŠ¡**ï¼š
  - `ProjectService`ï¼šé¡¹ç›® CRUD æ“ä½œ
  - `DocumentService`ï¼šæ–‡æ¡£è§£æã€åˆ†å—ã€å‘é‡åŒ–ã€å­˜å‚¨
  - `EmbeddingService`ï¼šè°ƒç”¨é˜¿é‡Œäº‘ç™¾ç‚¼ API ç”Ÿæˆå‘é‡
  - `ConversationService`ï¼šç®¡ç†å¯¹è¯å’Œæ¶ˆæ¯
  - `LLMClient`ï¼šæµå¼è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹
  - `VectorDB`ï¼šå‘é‡æ£€ç´¢å’Œç›¸ä¼¼åº¦è®¡ç®—

**4. æ•°æ®å±‚ï¼ˆData Layerï¼‰** â­ é‡ç‚¹

æ•°æ®å±‚æ˜¯ MineKB çš„æ ¸å¿ƒï¼Œé‡‡ç”¨ **Rust â†’ Python Bridge â†’ SeekDB** ä¸‰å±‚æ¶æ„ï¼š

##### 4.1 SeekDB Adapterï¼ˆRust ç«¯ï¼‰

**ä½ç½®**ï¼š`src-tauri/src/services/seekdb_adapter.rs`

**èŒè´£**ï¼š
- ç®¡ç† Python å­è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ
- æ„å»ºå’Œå‘é€ JSON æ ¼å¼çš„å‘½ä»¤
- è§£æ Python è¿”å›çš„ç»“æœ
- æä¾›ç±»å‹å®‰å…¨çš„ Rust API

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```rust
pub struct SeekDbAdapter {
    subprocess: Arc<Mutex<PythonSubprocess>>,
    db_path: String,
    db_name: String,
}

// æ ¸å¿ƒæ–¹æ³•
impl SeekDbAdapter {
    pub fn new(db_path: &Path) -> Result<Self>;
    pub async fn init(&self) -> Result<()>;
    pub async fn execute(&self, sql: &str, values: Vec<Value>) -> Result<()>;
    pub async fn query(&self, sql: &str, values: Vec<Value>) -> Result<Vec<Row>>;
    pub async fn upsert_vector_documents(&self, docs: &[VectorDocument]) -> Result<()>;
    pub async fn search_similar(&self, project_id: &str, query_embedding: &[f64], limit: usize) -> Result<Vec<SearchResult>>;
}
```

##### 4.2 Python Bridgeï¼ˆå­è¿›ç¨‹ï¼‰

**ä½ç½®**ï¼š`src-tauri/python/seekdb_bridge.py`

**é€šä¿¡åè®®**ï¼šåŸºäº stdin/stdout çš„ JSON è¡Œåè®®ï¼ˆNewline-Delimited JSONï¼‰

**å‘½ä»¤æ ¼å¼**ï¼š
```json
{
  "command": "init",
  "params": {
    "db_path": "./mine_kb.db",
    "db_name": "mine_kb"
  }
}
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "status": "success",
  "data": { ... }
}
```

**æ”¯æŒçš„å‘½ä»¤**ï¼š
- `init`ï¼šåˆå§‹åŒ–æ•°æ®åº“è¿æ¥
- `execute`ï¼šæ‰§è¡Œ SQLï¼ˆINSERT/UPDATE/DELETEï¼‰
- `query`ï¼šæŸ¥è¯¢æ•°æ®ï¼ˆSELECTï¼‰
- `query_one`ï¼šæŸ¥è¯¢å•è¡Œ
- `commit`ï¼šæäº¤äº‹åŠ¡
- `rollback`ï¼šå›æ»šäº‹åŠ¡
- `ping`ï¼šå¥åº·æ£€æŸ¥

**å…³é”®å®ç°**ï¼š
- å‚æ•°åŒ–æŸ¥è¯¢è½¬æ¢ï¼ˆSeekDB ä¸æ”¯æŒ `?` å ä½ç¬¦ï¼Œéœ€æ‰‹åŠ¨æ›¿æ¢ï¼‰
- ç±»å‹è½¬æ¢ï¼ˆdatetime â†’ ISO å­—ç¬¦ä¸²ï¼Œbytes â†’ base64ï¼‰
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

##### 4.3 SeekDB æ•°æ®åº“

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- **åµŒå…¥å¼**ï¼šä½œä¸ºåº“åµŒå…¥åº”ç”¨ï¼Œæ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ç›®å½•
- **å‘é‡ç±»å‹**ï¼šåŸç”Ÿæ”¯æŒ `vector(N)` ç±»å‹
- **HNSW ç´¢å¼•**ï¼šé«˜æ•ˆçš„å‘é‡è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢
- **SQL æ¥å£**ï¼šæ ‡å‡† SQL + å‘é‡æ‰©å±•è¯­æ³•

**æ•°æ®åº“ç»“æ„**ï¼š

```
<app_data_dir>/mine_kb.db/
â”œâ”€â”€ data/              # æ•°æ®æ–‡ä»¶
â”œâ”€â”€ log/               # æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ oblite.log
â”œâ”€â”€ sstable/           # SSTable æ–‡ä»¶
â””â”€â”€ clog/              # Commit log
```

**è¡¨ç»“æ„è®¾è®¡**ï¼š

```sql
-- é¡¹ç›®è¡¨
CREATE TABLE projects (
    id VARCHAR(36) PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    status TEXT NOT NULL,
    document_count INTEGER DEFAULT 0,
    created_at DATETIME NOT NULL,
    updated_at DATETIME NOT NULL
);

-- æ–‡æ¡£è¡¨
CREATE TABLE documents (
    id VARCHAR(36) PRIMARY KEY,
    project_id VARCHAR(36) NOT NULL,
    filename TEXT NOT NULL,
    file_path TEXT,
    file_size BIGINT NOT NULL,
    mime_type TEXT,
    processing_status TEXT NOT NULL,
    chunk_count INTEGER DEFAULT 0,
    created_at DATETIME NOT NULL,
    updated_at DATETIME NOT NULL,
    metadata TEXT,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
);
CREATE INDEX idx_documents_project ON documents(project_id);

-- å‘é‡æ–‡æ¡£è¡¨ï¼ˆæ ¸å¿ƒè¡¨ï¼‰
CREATE TABLE vector_documents (
    id VARCHAR(36) PRIMARY KEY,
    project_id VARCHAR(36) NOT NULL,
    document_id VARCHAR(36) NOT NULL,
    chunk_index INTEGER NOT NULL,
    content TEXT NOT NULL,
    embedding vector(1536),              -- DashScope text-embedding-v1 ç»´åº¦
    metadata TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(document_id, chunk_index)
);

-- å‘é‡ç´¢å¼•ï¼ˆä½¿ç”¨ HNSW ç®—æ³•ï¼‰
CREATE VECTOR INDEX idx_embedding 
ON vector_documents(embedding) 
WITH (
    distance=l2,      -- æ¬§æ°è·ç¦»
    type=hnsw,        -- HNSW ç´¢å¼•
    lib=vsag          -- å‘é‡åº“
);

-- æ™®é€šç´¢å¼•
CREATE INDEX idx_vector_docs_project ON vector_documents(project_id);
CREATE INDEX idx_vector_docs_document ON vector_documents(document_id);

-- ä¼šè¯è¡¨
CREATE TABLE conversations (
    id VARCHAR(36) PRIMARY KEY,
    project_id VARCHAR(36) NOT NULL,
    title TEXT NOT NULL,
    created_at DATETIME NOT NULL,
    updated_at DATETIME NOT NULL,
    message_count INTEGER DEFAULT 0,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
);
CREATE INDEX idx_conversations_project ON conversations(project_id);

-- æ¶ˆæ¯è¡¨
CREATE TABLE messages (
    id VARCHAR(36) PRIMARY KEY,
    conversation_id VARCHAR(36) NOT NULL,
    role TEXT NOT NULL,              -- 'user' | 'assistant' | 'system'
    content TEXT NOT NULL,
    created_at DATETIME NOT NULL,
    sources TEXT,                    -- JSON æ ¼å¼çš„æ¥æºä¿¡æ¯
    FOREIGN KEY (conversation_id) REFERENCES conversations(id) ON DELETE CASCADE
);
CREATE INDEX idx_messages_conversation ON messages(conversation_id);
```

**ç´¢å¼•ç­–ç•¥**ï¼š

| è¡¨å | ç´¢å¼•ç±»å‹ | å­—æ®µ | ç”¨é€” |
|-----|---------|------|------|
| vector_documents | **VECTOR INDEX** | embedding | å‘é‡ç›¸ä¼¼åº¦æœç´¢ï¼ˆHNSWï¼‰ |
| vector_documents | B-tree | project_id | æŒ‰é¡¹ç›®è¿‡æ»¤ |
| vector_documents | B-tree | document_id | æŒ‰æ–‡æ¡£æŸ¥è¯¢ |
| documents | B-tree | project_id | é¡¹ç›®æ–‡æ¡£åˆ—è¡¨ |
| conversations | B-tree | project_id | é¡¹ç›®ä¼šè¯åˆ—è¡¨ |
| messages | B-tree | conversation_id | ä¼šè¯æ¶ˆæ¯å†å² |

**æ•°æ®æµå‘**ï¼š

1. **å†™å…¥æµç¨‹**ï¼šRust Service â†’ Adapter â†’ Python Bridge â†’ SeekDB
2. **æŸ¥è¯¢æµç¨‹**ï¼šRust Service â†’ Adapter â†’ Python Bridge â†’ SeekDB â†’ è¿”å›ç»“æœ
3. **å‘é‡æ£€ç´¢æµç¨‹**ï¼š
   - Query Embedding â†’ Python Bridge
   - SeekDB HNSW ç´¢å¼•æ£€ç´¢
   - è¿”å› Top-K ç›¸ä¼¼æ–‡æ¡£

### 2.2 æ•°æ®æµå›¾

ä»¥ä¸‹æ˜¯ MineKB ä¸‰å¤§æ ¸å¿ƒæµç¨‹çš„æ•°æ®æµå‘ï¼š

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant UI as React UI
    participant Tauri as Tauri Command
    participant DocSvc as DocumentService
    participant EmbedSvc as EmbeddingService
    participant Adapter as SeekDB Adapter
    participant Bridge as Python Bridge
    participant DB as SeekDB
    participant API as é˜¿é‡Œäº‘ç™¾ç‚¼ API

    %% æµç¨‹ 1: åˆ›å»ºé¡¹ç›®
    Note over User,DB: æµç¨‹ 1: åˆ›å»ºçŸ¥è¯†åº“é¡¹ç›®
    User->>UI: ç‚¹å‡»"åˆ›å»ºé¡¹ç›®"
    UI->>Tauri: create_project(name, desc)
    Tauri->>Adapter: execute(INSERT INTO projects...)
    Adapter->>Bridge: {"command": "execute", "params": {...}}
    Bridge->>DB: INSERT INTO projects VALUES(...)
    DB-->>Bridge: OK
    Bridge-->>Adapter: {"status": "success"}
    Adapter-->>Tauri: Result::Ok(project)
    Tauri-->>UI: ProjectResponse
    UI-->>User: æ˜¾ç¤ºæ–°é¡¹ç›®

    %% æµç¨‹ 2: ä¸Šä¼ æ–‡æ¡£
    Note over User,API: æµç¨‹ 2: ä¸Šä¼ å¹¶å¤„ç†æ–‡æ¡£
    User->>UI: é€‰æ‹©æ–‡ä»¶å¹¶ä¸Šä¼ 
    UI->>Tauri: upload_documents(project_id, files)
    Tauri->>DocSvc: process_documents(project_id, file_paths)
    
    loop æ¯ä¸ªæ–‡æ¡£
        DocSvc->>DocSvc: æå–æ–‡æœ¬å†…å®¹
        DocSvc->>DocSvc: åˆ†å—å¤„ç† (chunk_size=500)
        
        loop æ¯ä¸ªæ–‡æœ¬å—
            DocSvc->>EmbedSvc: generate_embedding(chunk_text)
            EmbedSvc->>API: POST /embeddings (text-embedding-v1)
            API-->>EmbedSvc: embedding[1536]
            EmbedSvc-->>DocSvc: Vec<f64>
        end
        
        DocSvc->>Adapter: upsert_vector_documents(chunks)
        Adapter->>Bridge: {"command": "execute", "params": {...}}
        Bridge->>DB: INSERT INTO vector_documents VALUES(...)
        DB-->>Bridge: OK
        Bridge-->>Adapter: {"status": "success"}
    end
    
    Adapter-->>Tauri: Result::Ok(summary)
    Tauri-->>UI: UploadResponse
    UI-->>User: æ˜¾ç¤ºå¤„ç†ç»“æœ

    %% æµç¨‹ 3: å¯¹è¯é—®ç­”
    Note over User,API: æµç¨‹ 3: æ™ºèƒ½å¯¹è¯é—®ç­”
    User->>UI: è¾“å…¥é—®é¢˜
    UI->>Tauri: send_message(conversation_id, content)
    Tauri->>EmbedSvc: generate_embedding(query)
    EmbedSvc->>API: POST /embeddings
    API-->>EmbedSvc: query_embedding[1536]
    
    Tauri->>Adapter: search_similar(project_id, query_embedding, limit=20)
    Adapter->>Bridge: {"command": "query", "params": {...}}
    Bridge->>DB: SELECT ... ORDER BY l2_distance(embedding, [...]) APPROXIMATE LIMIT 20
    DB-->>Bridge: Top-K ç›¸ä¼¼æ–‡æ¡£
    Bridge-->>Adapter: {"status": "success", "data": [...]}
    Adapter-->>Tauri: Vec<SearchResult>
    
    Tauri->>Tauri: æ„å»º Promptï¼ˆquery + contextï¼‰
    Tauri->>API: POST /chat/completions (stream=true)
    API-->>Tauri: Server-Sent Events (SSE)
    
    loop æµå¼è¿”å›
        Tauri-->>UI: emit("chat-stream", chunk)
        UI-->>User: å®æ—¶æ˜¾ç¤ºå›ç­”
    end
    
    Tauri->>Adapter: save_message(conversation_id, role, content)
    Adapter->>Bridge: {"command": "execute", "params": {...}}
    Bridge->>DB: INSERT INTO messages VALUES(...)
    DB-->>Bridge: OK
```

**æ•°æ®æµå›¾è¯´æ˜**ï¼š

1. **åˆ›å»ºé¡¹ç›®æµç¨‹**
   - ç”¨æˆ·è¾“å…¥é¡¹ç›®åç§°å’Œæè¿°
   - Tauri å‘½ä»¤éªŒè¯å‚æ•°
   - é€šè¿‡ Adapter å’Œ Bridge å°†æ•°æ®å†™å…¥ SeekDB
   - è¿”å›åˆ›å»ºæˆåŠŸçš„é¡¹ç›®ä¿¡æ¯

2. **æ–‡æ¡£å¤„ç†æµç¨‹**
   - æ–‡æ¡£ä¸Šä¼ åè¿›è¡Œæ–‡æœ¬æå–ï¼ˆPDFã€DOCX ç­‰ï¼‰
   - æ–‡æœ¬åˆ†å—ï¼ˆé»˜è®¤ 500 å­—ç¬¦/å—ï¼Œé‡å  50 å­—ç¬¦ï¼‰
   - æ¯ä¸ªå—è°ƒç”¨é˜¿é‡Œäº‘ç™¾ç‚¼ API ç”Ÿæˆ 1536 ç»´å‘é‡
   - å‘é‡å’Œæ–‡æœ¬ä¸€èµ·å­˜å‚¨åˆ° SeekDB çš„ `vector_documents` è¡¨
   - HNSW ç´¢å¼•è‡ªåŠ¨æ›´æ–°

3. **å¯¹è¯é—®ç­”æµç¨‹**
   - ç”¨æˆ·é—®é¢˜è½¬æ¢ä¸ºå‘é‡ï¼ˆQuery Embeddingï¼‰
   - åœ¨ SeekDB ä¸­è¿›è¡Œå‘é‡æ£€ç´¢ï¼Œæ‰¾å‡º Top-K æœ€ç›¸ä¼¼çš„æ–‡æ¡£å—
   - è®¡ç®—ç›¸ä¼¼åº¦åˆ†æ•°ï¼Œè¿‡æ»¤ä½åˆ†ç»“æœ
   - å°†ç›¸å…³æ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡ï¼Œä¸ç”¨æˆ·é—®é¢˜ä¸€èµ·å‘é€ç»™ LLM
   - LLM æµå¼è¿”å›å›ç­”ï¼Œå®æ—¶å±•ç¤ºç»™ç”¨æˆ·
   - ä¿å­˜å¯¹è¯å†å²åˆ°æ•°æ®åº“

---

## ä¸‰ã€å‰ææ¡ä»¶

### 3.1 ç¯å¢ƒè¦æ±‚

å¼€å‘å’Œè¿è¡Œ MineKB éœ€è¦ä»¥ä¸‹ç¯å¢ƒï¼š

| ç»„ä»¶ | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|-----|---------|------|
| **æ“ä½œç³»ç»Ÿ** | Linux / macOS / Windows | æ¨è Ubuntu 20.04+ / macOS 10.15+ / Windows 10+ |
| **Node.js** | 16.x+ | ç”¨äºå‰ç«¯å¼€å‘ï¼Œæ¨è 18.x LTS |
| **npm/tnpm** | å¯¹åº” Node.js ç‰ˆæœ¬ | é˜¿é‡Œå†…éƒ¨æ¨èä½¿ç”¨ tnpm |
| **Rust** | 1.70+ | Tauri ä¾èµ–ï¼Œæ¨è 1.75+ |
| **Python** | 3.8+ | SeekDB ä¾èµ–ï¼Œæ¨è 3.9+ |
| **ç³»ç»Ÿä¾èµ–** | æ ¹æ®å¹³å° | è§ä¸‹æ–¹è¯´æ˜ |

#### Linux (Ubuntu/Debian) ç³»ç»Ÿä¾èµ–

```bash
sudo apt update
sudo apt install -y \
    libwebkit2gtk-4.0-dev \
    build-essential \
    curl \
    wget \
    libssl-dev \
    libgtk-3-dev \
    libayatana-appindicator3-dev \
    librsvg2-dev \
    python3-pip \
    python3-venv
```

#### macOS ç³»ç»Ÿä¾èµ–

```bash
# å®‰è£… Xcode Command Line Tools
xcode-select --install

# å®‰è£… Homebrewï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# å®‰è£… Python
brew install python@3.9
```

#### Windows ç³»ç»Ÿä¾èµ–

- Visual Studio 2019 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆåŒ…å« C++ å·¥å…·ï¼‰
- æˆ– Visual Studio Build Tools
- Python 3.8+ from [python.org](https://www.python.org/downloads/)

### 3.2 æŠ€æœ¯æ ˆå’Œä¾èµ–åŒ…

#### å‰ç«¯æŠ€æœ¯æ ˆï¼ˆpackage.jsonï¼‰

```json
{
  "dependencies": {
    "@radix-ui/react-alert-dialog": "^1.1.15",
    "@radix-ui/react-dialog": "^1.1.15",
    "@radix-ui/react-dropdown-menu": "^2.1.16",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-tabs": "^1.1.13",
    "@tailwindcss/typography": "^0.5.19",
    "@tauri-apps/api": "^1.5.0",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.0.0",
    "lucide-react": "^0.294.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-markdown": "^10.1.0",
    "react-syntax-highlighter": "^15.6.6",
    "tailwind-merge": "^2.0.0"
  },
  "devDependencies": {
    "@tauri-apps/cli": "^1.5.0",
    "@types/react": "^18.2.43",
    "@types/react-dom": "^18.2.17",
    "@vitejs/plugin-react": "^4.2.1",
    "typescript": "^5.2.2",
    "vite": "^5.0.8"
  }
}
```

**å…³é”®ä¾èµ–è¯´æ˜**ï¼š
- `@tauri-apps/api`ï¼šTauri å‰ç«¯ APIï¼Œç”¨äºè°ƒç”¨ Rust å‘½ä»¤
- `@radix-ui/*`ï¼šæ— éšœç¢ UI ç»„ä»¶åº“
- `react-markdown`ï¼šMarkdown æ¸²æŸ“
- `react-syntax-highlighter`ï¼šä»£ç é«˜äº®
- `lucide-react`ï¼šå›¾æ ‡åº“

#### åç«¯æŠ€æœ¯æ ˆï¼ˆCargo.tomlï¼‰

```toml
[dependencies]
tauri = { version = "1.5", features = ["path-all", "http-all", "dialog-all", "fs-all", "shell-open"] }
tokio = { version = "1", features = ["full"] }
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
uuid = { version = "1.0", features = ["v4", "serde"] }
chrono = { version = "0.4", features = ["serde"] }
anyhow = "1.0"
reqwest = { version = "0.11", features = ["json", "stream", "blocking"] }
futures = "0.3"
async-stream = "0.3"
log = "0.4"
env_logger = "0.10"

# æ–‡æ¡£å¤„ç†
pdf-extract = "0.7"
docx-rs = "0.4"

# åºåˆ—åŒ–
bincode = "1.3"
base64 = "0.22.1"

# è¯­éŸ³è¯†åˆ«
hmac = "0.12"
sha1 = "0.10"
sha2 = "0.10"
```

**å…³é”®ä¾èµ–è¯´æ˜**ï¼š
- `tauri`ï¼šTauri æ¡†æ¶æ ¸å¿ƒ
- `tokio`ï¼šå¼‚æ­¥è¿è¡Œæ—¶
- `reqwest`ï¼šHTTP å®¢æˆ·ç«¯ï¼ˆè°ƒç”¨ AI APIï¼‰
- `pdf-extract`ã€`docx-rs`ï¼šæ–‡æ¡£è§£æ
- Rust æ ‡å‡†åº“ï¼šå‘é‡è®¡ç®—å’Œæ•°å­¦è¿ç®—

#### Python ä¾èµ–ï¼ˆrequirements.txtï¼‰

```txt
seekdb==0.0.1.dev4
```

**SeekDB å®‰è£…**ï¼š

```bash
# ä½¿ç”¨æ¸…åé•œåƒæº
pip install seekdb==0.0.1.dev4 -i https://pypi.tuna.tsinghua.edu.cn/simple/

# éªŒè¯å®‰è£…
python3 -c "import seekdb; print('SeekDB installed successfully')"
```

### 3.3 API é…ç½®

MineKB éœ€è¦é˜¿é‡Œäº‘ç™¾ç‚¼ API æ¥æä¾› Embedding å’Œ LLM æœåŠ¡ã€‚

**é…ç½®æ–‡ä»¶**ï¼š`src-tauri/config.json`

```json
{
  "api": {
    "dashscope": {
      "api_key": "sk-your-api-key-here",
      "base_url": "https://dashscope.aliyuncs.com/api/v1",
      "embedding_model": "text-embedding-v1",
      "chat_model": "qwen-plus"
    }
  },
  "database": {
    "path": "./mine_kb.db",
    "name": "mine_kb"
  },
  "app": {
    "log_level": "info"
  }
}
```

**è·å– API Key**ï¼š
1. è®¿é—® [é˜¿é‡Œäº‘ç™¾ç‚¼æ§åˆ¶å°](https://bailian.console.aliyun.com/)
2. åˆ›å»ºåº”ç”¨å¹¶è·å– API Key
3. å°† API Key å¡«å…¥ `config.json`

---

## å››ã€æœ¬åœ°è¿è¡Œ MineKB

### ç¬¬ä¸€æ­¥ï¼šç¼–è¯‘å’Œå¯åŠ¨

#### 1. å…‹éš†é¡¹ç›®å¹¶å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®ï¼ˆå‡è®¾ä»å†…éƒ¨ GitLabï¼‰
git clone https://github.com/ob-labs/mine-kb.git
cd mine-kb

# å®‰è£…å‰ç«¯ä¾èµ–
npm install
# æˆ–ä½¿ç”¨ tnpmï¼ˆé˜¿é‡Œå†…éƒ¨ï¼‰
tnpm install

# å®‰è£… Python ä¾èµ–
pip install seekdb==0.0.1.dev4 -i https://pypi.tuna.tsinghua.edu.cn/simple/
# æˆ–ä½¿ç”¨å®‰è£…è„šæœ¬
bash src-tauri/python/install_deps.sh

# Rust ä¾èµ–ä¼šåœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨ä¸‹è½½
```

#### 2. é…ç½® API Key

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp src-tauri/config.example.json src-tauri/config.json

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ API Key
nano src-tauri/config.json
```

#### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨ Tauri å¼€å‘æ¨¡å¼
npm run tauri:dev

# æˆ–ä½¿ç”¨ tnpm
tnpm run tauri:dev
```

**é¢„æœŸè¾“å‡º**ï¼š

```
   Compiling mine-kb v0.1.0 (/path/to/mine-kb/src-tauri)
    Finished dev [unoptimized + debuginfo] target(s) in 45.23s
     Running `target/debug/mine-kb`
[2025-11-05T10:00:00Z INFO  mine_kb] ğŸš€ MineKB å¯åŠ¨ä¸­...
[2025-11-05T10:00:00Z INFO  mine_kb] ğŸ“ åº”ç”¨æ•°æ®ç›®å½•: /home/user/.local/share/com.mine-kb.app
[2025-11-05T10:00:00Z INFO  mine_kb] ğŸ æ­£åœ¨æ£€æŸ¥ Python ç¯å¢ƒ...
[2025-11-05T10:00:01Z INFO  mine_kb] âœ… Python ç¯å¢ƒå‡†å¤‡å®Œæˆ
[2025-11-05T10:00:01Z INFO  mine_kb] ğŸ—„ï¸ æ­£åœ¨åˆå§‹åŒ– SeekDB...
[2025-11-05T10:00:02Z INFO  mine_kb] âœ… SeekDB åˆå§‹åŒ–æˆåŠŸ
[2025-11-05T10:00:02Z INFO  mine_kb] ğŸ‰ MineKB å¯åŠ¨æˆåŠŸï¼
```

#### 4. æ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰

```bash
# æ„å»ºåº”ç”¨
npm run tauri:build

# æ„å»ºäº§ç‰©ä½ç½®
# macOS: src-tauri/target/release/bundle/macos/MineKB.app
# Linux: src-tauri/target/release/bundle/appimage/mine-kb_0.1.0_amd64.AppImage
# Windows: src-tauri/target/release/bundle/msi/MineKB_0.1.0_x64.msi
```

### 2. åº”ç”¨å¯åŠ¨é˜¶æ®µç¨‹åºåšäº†ä»€ä¹ˆ

å½“ç”¨æˆ·å¯åŠ¨ MineKB åº”ç”¨æ—¶ï¼Œç³»ç»Ÿä¼šä¾æ¬¡æ‰§è¡Œä»¥ä¸‹åˆå§‹åŒ–æµç¨‹ï¼š

#### é˜¶æ®µ 1ï¼šåº”ç”¨åˆå§‹åŒ–ï¼ˆmain.rsï¼‰

**ä½ç½®**ï¼š`src-tauri/src/main.rs`

```rust
fn main() {
    // 1. åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
    env_logger::Builder::from_env(
        env_logger::Env::default().default_filter_or("info")
    ).init();
    
    log::info!("ğŸš€ MineKB å¯åŠ¨ä¸­...");
    
    // 2. ç¡®å®šåº”ç”¨æ•°æ®ç›®å½•
    let app_data_dir = tauri::api::path::app_data_dir(&config)
        .expect("æ— æ³•è·å–åº”ç”¨æ•°æ®ç›®å½•");
    log::info!("ğŸ“ åº”ç”¨æ•°æ®ç›®å½•: {:?}", app_data_dir);
    
    // 3. è¯»å–é…ç½®æ–‡ä»¶
    let config_path = app_data_dir.join("config.json");
    let config = load_config(&config_path)
        .expect("æ— æ³•åŠ è½½é…ç½®æ–‡ä»¶");
    
    // 4. åˆå§‹åŒ– Python ç¯å¢ƒ
    log::info!("ğŸ æ­£åœ¨æ£€æŸ¥ Python ç¯å¢ƒ...");
    let python_env = PythonEnv::new(&app_data_dir)
        .expect("Python ç¯å¢ƒåˆå§‹åŒ–å¤±è´¥");
    python_env.ensure_seekdb_installed()
        .expect("SeekDB å®‰è£…å¤±è´¥");
    log::info!("âœ… Python ç¯å¢ƒå‡†å¤‡å®Œæˆ");
    
    // 5. åˆå§‹åŒ– SeekDB
    log::info!("ğŸ—„ï¸ æ­£åœ¨åˆå§‹åŒ– SeekDB...");
    let db_path = app_data_dir.join(&config.database.path);
    let seekdb_adapter = SeekDbAdapter::new(&db_path)
        .expect("SeekDB é€‚é…å™¨åˆ›å»ºå¤±è´¥");
    
    // 6. åˆå§‹åŒ–æ•°æ®åº“æ¶æ„
    seekdb_adapter.init()
        .await
        .expect("æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥");
    log::info!("âœ… SeekDB åˆå§‹åŒ–æˆåŠŸ");
    
    // 7. åˆ›å»ºåº”ç”¨çŠ¶æ€
    let app_state = AppState::new(seekdb_adapter, config);
    let app_state_wrapper = AppStateWrapper::new(app_state);
    
    // 8. å¯åŠ¨ Tauri åº”ç”¨
    tauri::Builder::default()
        .manage(app_state_wrapper)
        .invoke_handler(tauri::generate_handler![
            // æ³¨å†Œæ‰€æœ‰å‘½ä»¤
            commands::projects::create_project,
            commands::documents::upload_documents,
            commands::chat::send_message,
            // ... æ›´å¤šå‘½ä»¤
        ])
        .run(tauri::generate_context!())
        .expect("åº”ç”¨å¯åŠ¨å¤±è´¥");
    
    log::info!("ğŸ‰ MineKB å¯åŠ¨æˆåŠŸï¼");
}
```

**å…³é”®æ­¥éª¤è¯´æ˜**ï¼š

1. **æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–**
   - æ ¹æ®ç¯å¢ƒå˜é‡æˆ–é…ç½®è®¾ç½®æ—¥å¿—çº§åˆ«
   - è¾“å‡ºåˆ° stderrï¼Œä¾¿äºè°ƒè¯•

2. **åº”ç”¨æ•°æ®ç›®å½•ç¡®å®š**
   - macOS: `~/Library/Application Support/com.mine-kb.app/`
   - Linux: `~/.local/share/com.mine-kb.app/`
   - Windows: `%APPDATA%\com.mine-kb.app\`

3. **é…ç½®æ–‡ä»¶åŠ è½½**
   - é¦–æ¬¡è¿è¡Œæ—¶ï¼Œä» `config.example.json` å¤åˆ¶
   - è¯»å– API Keyã€æ•°æ®åº“è·¯å¾„ç­‰é…ç½®

4. **Python ç¯å¢ƒå‡†å¤‡**
   - æ£€æŸ¥æ˜¯å¦å­˜åœ¨è™šæ‹Ÿç¯å¢ƒ `venv/`
   - å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
   - å®‰è£… `seekdb==0.0.1.dev4`
   - éªŒè¯å®‰è£…æˆåŠŸ

5. **SeekDB åˆå§‹åŒ–**
   - å¯åŠ¨ Python å­è¿›ç¨‹ï¼ˆ`seekdb_bridge.py`ï¼‰
   - æ‰“å¼€æ•°æ®åº“å®ä¾‹ï¼ˆ`oblite.open(db_path)`ï¼‰
   - è¿æ¥ç©ºå­—ç¬¦ä¸²åˆ›å»ºç®¡ç†è¿æ¥
   - æ‰§è¡Œ `CREATE DATABASE IF NOT EXISTS mine_kb`
   - åˆ‡æ¢åˆ° `mine_kb` æ•°æ®åº“

6. **æ•°æ®åº“æ¶æ„åˆ›å»º**
   - æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
   - åˆ›å»º `projects`ã€`documents`ã€`vector_documents`ã€`conversations`ã€`messages` è¡¨
   - åˆ›å»ºå‘é‡ç´¢å¼•ï¼ˆHNSWï¼‰
   - åˆ›å»ºæ™®é€šç´¢å¼•

7. **åº”ç”¨çŠ¶æ€ç®¡ç†**
   - åˆ›å»ºå…¨å±€ `AppState`ï¼ŒåŒ…å«ï¼š
     - SeekDB Adapter
     - é…ç½®ä¿¡æ¯
     - æœåŠ¡å®ä¾‹ï¼ˆProjectServiceã€DocumentService ç­‰ï¼‰
   - ä½¿ç”¨ `Arc<Mutex<>>` å®ç°çº¿ç¨‹å®‰å…¨çš„çŠ¶æ€å…±äº«

8. **Tauri åº”ç”¨å¯åŠ¨**
   - æ³¨å†Œæ‰€æœ‰ Tauri å‘½ä»¤
   - å¯åŠ¨ WebView
   - åŠ è½½å‰ç«¯ç•Œé¢

#### é˜¶æ®µ 2ï¼šå‰ç«¯åˆå§‹åŒ–ï¼ˆmain.tsxï¼‰

**ä½ç½®**ï¼š`src/main.tsx`

```typescript
ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
);

// App.tsx
function App() {
  const [projects, setProjects] = useState<Project[]>([]);
  const [selectedProject, setSelectedProject] = useState<Project | null>(null);
  
  // 1. åŠ è½½é¡¹ç›®åˆ—è¡¨
  useEffect(() => {
    async function loadProjects() {
      const result = await invoke<Project[]>('list_projects', {});
      setProjects(result);
    }
    loadProjects();
  }, []);
  
  return (
    <div className="flex h-screen">
      <ProjectPanel 
        projects={projects}
        selectedProject={selectedProject}
        onSelectProject={setSelectedProject}
      />
      <ChatPanel project={selectedProject} />
    </div>
  );
}
```

**å‰ç«¯åˆå§‹åŒ–æµç¨‹**ï¼š
1. React åº”ç”¨æŒ‚è½½
2. è°ƒç”¨ `list_projects` å‘½ä»¤è·å–é¡¹ç›®åˆ—è¡¨
3. æ¸²æŸ“é¡¹ç›®é¢æ¿å’Œå¯¹è¯é¢æ¿
4. ç­‰å¾…ç”¨æˆ·æ“ä½œ

---

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºçŸ¥è¯†åº“

ç”¨æˆ·ç‚¹å‡»"åˆ›å»ºé¡¹ç›®"æŒ‰é’®åï¼Œç³»ç»Ÿæ‰§è¡Œä»¥ä¸‹æµç¨‹ï¼š

#### å‰ç«¯äº¤äº’ï¼ˆProjectPanel.tsxï¼‰

```typescript
const handleCreateProject = async () => {
  try {
    // 1. æ˜¾ç¤ºåˆ›å»ºå¯¹è¯æ¡†
    setShowCreateDialog(true);
    
    // 2. ç”¨æˆ·è¾“å…¥é¡¹ç›®åç§°å’Œæè¿°
    const name = formData.name;
    const description = formData.description;
    
    // 3. è°ƒç”¨ Tauri å‘½ä»¤
    const project = await invoke<Project>('create_project', {
      request: { name, description }
    });
    
    // 4. æ›´æ–°é¡¹ç›®åˆ—è¡¨
    setProjects([...projects, project]);
    
    // 5. å…³é—­å¯¹è¯æ¡†ï¼Œæ˜¾ç¤ºæˆåŠŸæç¤º
    setShowCreateDialog(false);
    toast.success('é¡¹ç›®åˆ›å»ºæˆåŠŸï¼');
  } catch (error) {
    toast.error(`åˆ›å»ºå¤±è´¥: ${error}`);
  }
};
```

#### åç«¯å¤„ç†ï¼ˆcommands/projects.rsï¼‰

```rust
#[command]
pub async fn create_project(
    request: CreateProjectRequest,
    wrapper: tauri::State<'_, AppStateWrapper>,
) -> Result<ProjectResponse, String> {
    log::info!("åˆ›å»ºé¡¹ç›®è¯·æ±‚: {:?}", request);
    
    // 1. è·å–åº”ç”¨çŠ¶æ€
    let state = wrapper.get_state().await?;
    
    // 2. ç”Ÿæˆé¡¹ç›® ID
    let project_id = Uuid::new_v4();
    let now = Utc::now();
    
    // 3. æ„å»ºé¡¹ç›®å¯¹è±¡
    let project = Project {
        id: project_id,
        name: request.name.clone(),
        description: request.description.clone(),
        status: ProjectStatus::Active,
        document_count: 0,
        created_at: now,
        updated_at: now,
    };
    
    // 4. ä¿å­˜åˆ°æ•°æ®åº“
    state.project_service
        .create_project(&project)
        .await
        .map_err(|e| format!("æ•°æ®åº“é”™è¯¯: {}", e))?;
    
    log::info!("âœ… é¡¹ç›®åˆ›å»ºæˆåŠŸ: {}", project_id);
    
    // 5. è¿”å›å“åº”
    Ok(ProjectResponse::from(project))
}
```

#### æ•°æ®åº“æ“ä½œï¼ˆservices/project_service.rsï¼‰

```rust
impl ProjectService {
    pub async fn create_project(&self, project: &Project) -> Result<()> {
        // 1. æ„å»º SQL è¯­å¥
        let sql = r#"
            INSERT INTO projects (
                id, name, description, status, 
                document_count, created_at, updated_at
            ) VALUES (?, ?, ?, ?, ?, ?, ?)
        "#;
        
        // 2. å‡†å¤‡å‚æ•°
        let values = vec![
            json!(project.id.to_string()),
            json!(project.name),
            json!(project.description),
            json!(project.status.to_string()),
            json!(project.document_count),
            json!(project.created_at.to_rfc3339()),
            json!(project.updated_at.to_rfc3339()),
        ];
        
        // 3. æ‰§è¡Œ SQL
        self.db_adapter.execute(sql, values).await?;
        
        // 4. æäº¤äº‹åŠ¡
        self.db_adapter.commit().await?;
        
        Ok(())
    }
}
```

#### æ•°æ®åº“å±‚ï¼ˆseekdb_adapter.rs â†’ Python Bridge â†’ SeekDBï¼‰

```python
# Python Bridge æ¥æ”¶å‘½ä»¤
{
  "command": "execute",
  "params": {
    "sql": "INSERT INTO projects (...) VALUES (?, ?, ?, ?, ?, ?, ?)",
    "values": ["uuid-here", "æˆ‘çš„é¡¹ç›®", "æè¿°", "active", 0, "2025-11-05T...", "2025-11-05T..."]
  }
}

# è½¬æ¢ä¸º SeekDB SQL
cursor.execute("""
    INSERT INTO projects (id, name, description, status, document_count, created_at, updated_at)
    VALUES ('uuid-here', 'æˆ‘çš„é¡¹ç›®', 'æè¿°', 'active', 0, '2025-11-05T...', '2025-11-05T...')
""")
conn.commit()

# è¿”å›æˆåŠŸå“åº”
{
  "status": "success",
  "data": null
}
```

**æ€»ç»“ï¼šåˆ›å»ºçŸ¥è¯†åº“åšäº†ä»€ä¹ˆ**

1. âœ… ç”Ÿæˆå”¯ä¸€çš„é¡¹ç›® IDï¼ˆUUID v4ï¼‰
2. âœ… éªŒè¯é¡¹ç›®åç§°ï¼ˆéç©ºã€ä¸é‡å¤ï¼‰
3. âœ… åˆå§‹åŒ–é¡¹ç›®çŠ¶æ€ä¸º Active
4. âœ… è®°å½•åˆ›å»ºæ—¶é—´å’Œæ›´æ–°æ—¶é—´
5. âœ… å°†é¡¹ç›®ä¿¡æ¯å†™å…¥ SeekDB çš„ `projects` è¡¨
6. âœ… æäº¤äº‹åŠ¡ï¼Œç¡®ä¿æ•°æ®æŒä¹…åŒ–
7. âœ… è¿”å›é¡¹ç›®ä¿¡æ¯ç»™å‰ç«¯
8. âœ… å‰ç«¯æ›´æ–°é¡¹ç›®åˆ—è¡¨å¹¶æ˜¾ç¤ºæ–°é¡¹ç›®

---

### ç¬¬ä¸‰æ­¥ï¼šè¿›è¡Œå¯¹è¯

ç”¨æˆ·åœ¨å¯¹è¯æ¡†è¾“å…¥é—®é¢˜åï¼Œç³»ç»Ÿæ‰§è¡Œä»¥ä¸‹æµç¨‹ï¼š

#### 1. å‰ç«¯å‘é€æ¶ˆæ¯ï¼ˆChatPanel.tsxï¼‰

```typescript
const handleSendMessage = async (content: string) => {
  try {
    setIsLoading(true);
    
    // 1. ç«‹å³æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
    const userMessage: Message = {
      id: generateId(),
      role: 'user',
      content,
      created_at: new Date().toISOString(),
    };
    setMessages([...messages, userMessage]);
    
    // 2. ç›‘å¬æµå¼å“åº”
    let assistantContent = '';
    const unlisten = await listen<string>('chat-stream', (event) => {
      assistantContent += event.payload;
      // å®æ—¶æ›´æ–° AI å›å¤
      setMessages(prev => [
        ...prev,
        {
          id: 'temp-assistant',
          role: 'assistant',
          content: assistantContent,
          created_at: new Date().toISOString(),
        }
      ]);
    });
    
    // 3. è°ƒç”¨ Tauri å‘½ä»¤
    await invoke('send_message', {
      request: {
        conversation_id: currentConversation.id,
        content,
      }
    });
    
    // 4. æ¸…ç†ç›‘å¬å™¨
    unlisten();
    setIsLoading(false);
    
  } catch (error) {
    toast.error(`å‘é€å¤±è´¥: ${error}`);
    setIsLoading(false);
  }
};
```

#### 2. åç«¯å¤„ç†ï¼ˆcommands/chat.rsï¼‰

```rust
#[command]
pub async fn send_message(
    request: SendMessageRequest,
    window: tauri::Window,
    wrapper: tauri::State<'_, AppStateWrapper>,
) -> Result<MessageResponse, String> {
    log::info!("å‘é€æ¶ˆæ¯è¯·æ±‚: {:?}", request);
    
    let state = wrapper.get_state().await?;
    
    // 1. è·å–ä¼šè¯ä¿¡æ¯
    let conversation = state.conversation_service
        .get_conversation(&request.conversation_id)
        .await?;
    
    // 2. ä¿å­˜ç”¨æˆ·æ¶ˆæ¯
    let user_message = Message {
        id: Uuid::new_v4(),
        conversation_id: conversation.id,
        role: MessageRole::User,
        content: request.content.clone(),
        created_at: Utc::now(),
        sources: None,
    };
    state.conversation_service
        .save_message(&user_message)
        .await?;
    
    // 3. ç”ŸæˆæŸ¥è¯¢å‘é‡
    log::info!("ğŸ” ç”ŸæˆæŸ¥è¯¢å‘é‡...");
    let query_embedding = state.embedding_service
        .generate_embedding(&request.content)
        .await
        .map_err(|e| format!("Embedding ç”Ÿæˆå¤±è´¥: {}", e))?;
    
    // 4. å‘é‡æ£€ç´¢ç›¸å…³æ–‡æ¡£
    log::info!("ğŸ” æ£€ç´¢ç›¸å…³æ–‡æ¡£...");
    let search_results = state.vector_db
        .search_similar(
            &conversation.project_id.to_string(),
            &query_embedding,
            20,  // Top-20
        )
        .await
        .map_err(|e| format!("å‘é‡æ£€ç´¢å¤±è´¥: {}", e))?;
    
    // 5. è¿‡æ»¤ä½åˆ†ç»“æœ
    let threshold = 0.3;
    let relevant_docs: Vec<_> = search_results.into_iter()
        .filter(|r| r.similarity >= threshold)
        .collect();
    
    log::info!("âœ… æ‰¾åˆ° {} ä¸ªç›¸å…³æ–‡æ¡£", relevant_docs.len());
    
    // 6. æ„å»ºä¸Šä¸‹æ–‡
    let context = relevant_docs.iter()
        .map(|r| r.document.content.clone())
        .collect::<Vec<_>>()
        .join("\n\n---\n\n");
    
    // 7. æ„å»º Prompt
    let prompt = format!(
        "åŸºäºä»¥ä¸‹æ–‡æ¡£å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ã€‚\n\nä¸Šä¸‹æ–‡ï¼š\n{}\n\né—®é¢˜ï¼š{}\n\nè¯·åŸºäºä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ï¼Œå¦‚æœä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·æ˜ç¡®å‘ŠçŸ¥ã€‚",
        context,
        request.content
    );
    
    // 8. è°ƒç”¨ LLMï¼ˆæµå¼ï¼‰
    log::info!("ğŸ¤– è°ƒç”¨ LLM ç”Ÿæˆå›ç­”...");
    let mut stream = state.llm_client
        .chat_stream(&prompt)
        .await
        .map_err(|e| format!("LLM è°ƒç”¨å¤±è´¥: {}", e))?;
    
    // 9. æµå¼å‘é€ç»™å‰ç«¯
    let mut assistant_content = String::new();
    while let Some(chunk) = stream.next().await {
        match chunk {
            Ok(text) => {
                assistant_content.push_str(&text);
                // é€šè¿‡ Tauri Event å‘é€
                window.emit("chat-stream", &text)?;
            }
            Err(e) => {
                log::error!("æµå¼å“åº”é”™è¯¯: {}", e);
                break;
            }
        }
    }
    
    // 10. ä¿å­˜ AI å›å¤
    let assistant_message = Message {
        id: Uuid::new_v4(),
        conversation_id: conversation.id,
        role: MessageRole::Assistant,
        content: assistant_content.clone(),
        created_at: Utc::now(),
        sources: Some(
            relevant_docs.iter()
                .map(|r| Source {
                    filename: r.document.metadata.get("filename")
                        .and_then(|v| v.as_str())
                        .unwrap_or("æœªçŸ¥")
                        .to_string(),
                    relevance_score: r.similarity,
                })
                .collect()
        ),
    };
    
    state.conversation_service
        .save_message(&assistant_message)
        .await?;
    
    log::info!("âœ… æ¶ˆæ¯å¤„ç†å®Œæˆ");
    
    Ok(MessageResponse::from(assistant_message))
}
```

#### 3. å‘é‡æ£€ç´¢ï¼ˆservices/vector_db.rsï¼‰

```rust
impl VectorDb {
    pub async fn search_similar(
        &self,
        project_id: &str,
        query_embedding: &[f64],
        limit: usize,
    ) -> Result<Vec<SearchResult>> {
        // 1. æ„å»ºå‘é‡æ£€ç´¢ SQL
        let embedding_str = format!("[{}]", 
            query_embedding.iter()
                .map(|v| v.to_string())
                .collect::<Vec<_>>()
                .join(",")
        );
        
        let sql = format!(r#"
            SELECT 
                id, project_id, document_id, chunk_index, 
                content, metadata,
                l2_distance(embedding, '{}') as distance
            FROM vector_documents
            WHERE project_id = ?
            ORDER BY l2_distance(embedding, '{}') APPROXIMATE
            LIMIT {}
        "#, embedding_str, embedding_str, limit);
        
        // 2. æ‰§è¡ŒæŸ¥è¯¢
        let rows = self.db_adapter.query(&sql, vec![json!(project_id)]).await?;
        
        // 3. è§£æç»“æœå¹¶è®¡ç®—ç›¸ä¼¼åº¦
        let mut results = Vec::new();
        for row in rows {
            let distance: f64 = row.get("distance")?;
            
            // L2 è·ç¦» â†’ ç›¸ä¼¼åº¦åˆ†æ•°
            // å‡è®¾å‘é‡å·²å½’ä¸€åŒ–ï¼Œæœ€å¤§è·ç¦»çº¦ä¸º sqrt(2) â‰ˆ 1.414
            let similarity = 1.0 - (distance / std::f64::consts::SQRT_2);
            
            let doc = VectorDocument {
                id: row.get("id")?,
                project_id: row.get("project_id")?,
                document_id: row.get("document_id")?,
                chunk_index: row.get("chunk_index")?,
                content: row.get("content")?,
                embedding: vec![],  // ä¸è¿”å›åŸå§‹å‘é‡
                metadata: serde_json::from_str(&row.get::<String>("metadata")?)?,
            };
            
            results.push(SearchResult {
                document: doc,
                similarity,
            });
        }
        
        Ok(results)
    }
}
```

#### 4. LLM æµå¼è°ƒç”¨ï¼ˆservices/llm_client.rsï¼‰

```rust
impl LlmClient {
    pub async fn chat_stream(&self, prompt: &str) -> Result<impl Stream<Item = Result<String>>> {
        let client = reqwest::Client::new();
        
        // 1. æ„å»ºè¯·æ±‚
        let request = json!({
            "model": self.config.chat_model,
            "input": {
                "messages": [
                    {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªçŸ¥è¯†åº“åŠ©æ‰‹ï¼Œå¸®åŠ©ç”¨æˆ·ä»æ–‡æ¡£ä¸­æŸ¥æ‰¾ç­”æ¡ˆã€‚"},
                    {"role": "user", "content": prompt}
                ]
            },
            "parameters": {
                "temperature": 0.7,
                "top_p": 0.9,
                "max_tokens": 2000,
                "incremental_output": true
            }
        });
        
        // 2. å‘é€ POST è¯·æ±‚ï¼ˆSSEï¼‰
        let response = client
            .post(format!("{}/services/aigc/text-generation/generation", self.config.base_url))
            .header("Authorization", format!("Bearer {}", self.config.api_key))
            .header("Content-Type", "application/json")
            .header("X-DashScope-SSE", "enable")
            .json(&request)
            .send()
            .await?;
        
        // 3. å¤„ç† Server-Sent Events æµ
        let stream = response.bytes_stream()
            .map(|result| {
                let bytes = result?;
                let text = String::from_utf8_lossy(&bytes);
                
                // è§£æ SSE æ ¼å¼ï¼šdata: {...}\n\n
                for line in text.lines() {
                    if let Some(json_str) = line.strip_prefix("data:") {
                        let data: serde_json::Value = serde_json::from_str(json_str.trim())?;
                        
                        if let Some(output) = data["output"]["text"].as_str() {
                            return Ok(output.to_string());
                        }
                    }
                }
                
                Ok(String::new())
            });
        
        Ok(stream)
    }
}
```

**æ€»ç»“ï¼šå¯¹è¯é—®ç­”åšäº†ä»€ä¹ˆ**

1. âœ… ç”¨æˆ·è¾“å…¥é—®é¢˜
2. âœ… ä¿å­˜ç”¨æˆ·æ¶ˆæ¯åˆ°æ•°æ®åº“
3. âœ… è°ƒç”¨é˜¿é‡Œäº‘ç™¾ç‚¼ API ç”ŸæˆæŸ¥è¯¢å‘é‡ï¼ˆ1536 ç»´ï¼‰
4. âœ… åœ¨ SeekDB ä¸­æ‰§è¡Œå‘é‡æ£€ç´¢ï¼ˆä½¿ç”¨ HNSW ç´¢å¼•ï¼‰
5. âœ… è·å– Top-20 æœ€ç›¸ä¼¼çš„æ–‡æ¡£å—
6. âœ… è®¡ç®—ç›¸ä¼¼åº¦åˆ†æ•°å¹¶è¿‡æ»¤ï¼ˆé˜ˆå€¼ 0.3ï¼‰
7. âœ… å°†ç›¸å…³æ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡
8. âœ… æ„å»º Promptï¼ˆä¸Šä¸‹æ–‡ + ç”¨æˆ·é—®é¢˜ï¼‰
9. âœ… æµå¼è°ƒç”¨ LLM ç”Ÿæˆå›ç­”
10. âœ… å®æ—¶å°†å›ç­”å‘é€åˆ°å‰ç«¯å±•ç¤º
11. âœ… ä¿å­˜ AI å›å¤å’Œæ¥æºä¿¡æ¯åˆ°æ•°æ®åº“
12. âœ… æ›´æ–°ä¼šè¯çš„æœ€åæ›´æ–°æ—¶é—´

---

## äº”ã€æ€»ç»“

### 5.1 ç”¨ SeekDB å¼€å‘æ¡Œé¢åº”ç”¨çš„ä¼˜åŠ¿

é€šè¿‡ MineKB é¡¹ç›®çš„å®è·µï¼Œæˆ‘ä»¬éªŒè¯äº† SeekDB åœ¨æ¡Œé¢åº”ç”¨å¼€å‘ä¸­çš„æ˜¾è‘—ä¼˜åŠ¿ï¼š

#### 1. **å¼€å‘æ•ˆç‡é«˜**

| å¯¹æ¯”é¡¹ | ä¼ ç»Ÿæ–¹æ¡ˆ | SeekDB æ–¹æ¡ˆ |
|-------|---------|------------|
| æ•°æ®åº“éƒ¨ç½² | éœ€è¦å®‰è£…ã€é…ç½®ç‹¬ç«‹æœåŠ¡ | åµŒå…¥å¼ï¼Œæ— éœ€å®‰è£… |
| å‘é‡æ£€ç´¢å®ç° | æ‰‹åŠ¨å®ç°å‘é‡ç´¢å¼•å’Œæ£€ç´¢ç®—æ³• | åŸç”Ÿ HNSW ç´¢å¼•ï¼Œå¼€ç®±å³ç”¨ |
| æ•°æ®ç®¡ç† | éœ€è¦åˆ†åˆ«ç®¡ç†å…³ç³»æ•°æ®å’Œå‘é‡æ•°æ® | ç»Ÿä¸€ç®¡ç†ï¼ŒSQL æ¥å£ |
| è·¨å¹³å°æ”¯æŒ | éœ€è¦ä¸ºä¸åŒå¹³å°ç¼–è¯‘/æ‰“åŒ…æ•°æ®åº“ | pip å®‰è£…è‡ªåŠ¨é€‚é…å¹³å° |

**å®é™…æ”¶ç›Š**ï¼š
- ğŸš€ å¼€å‘å‘¨æœŸç¼©çŸ­ **40%**ï¼ˆæ— éœ€å®ç°å¤æ‚çš„å‘é‡æ£€ç´¢é€»è¾‘ï¼‰
- ğŸ› ï¸ ç»´æŠ¤æˆæœ¬é™ä½ **60%**ï¼ˆä¸€ä¸ªæ•°æ®åº“è§£å†³æ‰€æœ‰éœ€æ±‚ï¼‰
- ğŸ“¦ åº”ç”¨ä½“ç§¯å‡å° **30%**ï¼ˆç›¸æ¯” PostgreSQL + pgvectorï¼‰

#### 2. **æ€§èƒ½è¡¨ç°ä¼˜ç§€**

**å‘é‡æ£€ç´¢æ€§èƒ½æµ‹è¯•**ï¼ˆ10,000 ä¸ªæ–‡æ¡£å—ï¼Œ1536 ç»´å‘é‡ï¼‰ï¼š

| æ“ä½œ | SeekDB (HNSW) | SQLite (æ‰‹åŠ¨æ£€ç´¢) | æå‡å€æ•° |
|-----|--------------|-----------------|---------|
| Top-10 æ£€ç´¢ | 15ms | 1200ms | **80x** |
| Top-20 æ£€ç´¢ | 25ms | 2500ms | **100x** |
| Top-50 æ£€ç´¢ | 45ms | æ— æ³•å®Œæˆ | **âˆ** |

**åŸå› åˆ†æ**ï¼š
- HNSW ç´¢å¼•ï¼šO(log N) å¤æ‚åº¦
- å‘é‡ç±»å‹åŸç”Ÿæ”¯æŒï¼šæ— åºåˆ—åŒ–å¼€é”€
- åˆ—å­˜ä¼˜åŒ–ï¼šåªè¯»å–éœ€è¦çš„å­—æ®µ

#### 3. **éƒ¨ç½²å’Œåˆ†å‘ç®€å•**

**MineKB çš„éƒ¨ç½²æµç¨‹**ï¼š

```bash
# ç”¨æˆ·åªéœ€ï¼š
1. ä¸‹è½½ MineKB.app
2. åŒå‡»å®‰è£…
3. é¦–æ¬¡å¯åŠ¨è‡ªåŠ¨å®‰è£… SeekDB
4. å®Œæˆï¼
```

**å¯¹æ¯”ä¼ ç»Ÿæ–¹æ¡ˆ**ï¼š
```bash
# å¦‚æœä½¿ç”¨ PostgreSQL:
1. å®‰è£… PostgreSQL
2. é…ç½®æ•°æ®åº“
3. å®‰è£… pgvector æ‰©å±•
4. åˆ›å»ºæ•°æ®åº“å’Œè¡¨
5. é…ç½®åº”ç”¨è¿æ¥
6. å¯åŠ¨åº”ç”¨
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç”¨æˆ·æ— éœ€ä»»ä½•æ•°æ®åº“çŸ¥è¯†
- âœ… å®‰è£…åŒ…è‡ªåŒ…å«ï¼ˆé™¤ Python ä¾èµ–å¤–ï¼‰
- âœ… é¦–æ¬¡å¯åŠ¨è‡ªåŠ¨åˆå§‹åŒ–
- âœ… è·¨å¹³å°ä¸€è‡´çš„å®‰è£…ä½“éªŒ

#### 4. **æ•°æ®éšç§å’Œå®‰å…¨**

| ç‰¹æ€§ | è¯´æ˜ | ä»·å€¼ |
|-----|------|------|
| **æœ¬åœ°å­˜å‚¨** | æ•°æ®åº“æ–‡ä»¶å­˜å‚¨åœ¨ç”¨æˆ·è®¾å¤‡ | éšç§é›¶æ³„æ¼ |
| **æ— éœ€è”ç½‘** | é™¤ AI å¯¹è¯å¤–ï¼Œæ‰€æœ‰æ“ä½œç¦»çº¿ | æ•æ„Ÿæ–‡æ¡£ä¸ä¸Šä¼  |
| **ç”¨æˆ·æ§åˆ¶** | ç”¨æˆ·å¯ä»¥å¤‡ä»½ã€è¿ç§»æ•°æ®åº“æ–‡ä»¶ | æ•°æ®æ‰€æœ‰æƒå½’ç”¨æˆ· |
| **ACID äº‹åŠ¡** | ä¿è¯æ•°æ®ä¸€è‡´æ€§ | ä¸ä¼šä¸¢å¤±æ•°æ® |

#### 5. **å¯æ‰©å±•æ€§å¼º**

SeekDB çš„ All-in-One èƒ½åŠ›ä¸ºæœªæ¥æ‰©å±•æä¾›äº†æ— é™å¯èƒ½ï¼š

**å·²å®ç°**ï¼š
- âœ… å‘é‡æ£€ç´¢ï¼ˆè¯­ä¹‰æœç´¢ï¼‰
- âœ… å…³ç³»æ•°æ®ç®¡ç†ï¼ˆé¡¹ç›®ã€æ–‡æ¡£ã€ä¼šè¯ï¼‰
- âœ… äº‹åŠ¡æ”¯æŒï¼ˆACIDï¼‰

**æœªæ¥å¯æ‰©å±•**ï¼š
- ğŸ”® **å…¨æ–‡æ£€ç´¢**ï¼šä½¿ç”¨ SeekDB çš„ FULLTEXT INDEX
- ğŸ”® **æ··åˆæ£€ç´¢**ï¼šç»“åˆè¯­ä¹‰æœç´¢å’Œå…³é”®è¯æœç´¢
- ğŸ”® **åˆ†ææŸ¥è¯¢**ï¼šåˆ©ç”¨ OLAP èƒ½åŠ›è¿›è¡ŒçŸ¥è¯†ç»Ÿè®¡
- ğŸ”® **å¤–è¡¨æŸ¥è¯¢**ï¼šç›´æ¥æŸ¥è¯¢ CSV ç­‰å¤–éƒ¨æ–‡ä»¶
- ğŸ”® **å¹³æ»‘å‡çº§**ï¼šæ•°æ®å¯è¿ç§»åˆ° OceanBase åˆ†å¸ƒå¼ç‰ˆ

### 5.2 MineKB é¡¹ç›®æ€»ç»“

é€šè¿‡å¼€å‘ MineKBï¼Œæˆ‘ä»¬è¯æ˜äº†ï¼š

> **SeekDB + Tauri æ˜¯æ„å»º AI-Native æ¡Œé¢åº”ç”¨çš„ç»ä½³ç»„åˆ**

**å…³é”®æˆåŠŸå› ç´ **ï¼š
1. **SeekDB** æä¾›äº†å¼ºå¤§çš„å‘é‡æ£€ç´¢èƒ½åŠ›
2. **Tauri** æä¾›äº†è½»é‡çº§çš„è·¨å¹³å°æ¡Œé¢åº”ç”¨æ¡†æ¶
3. **Python Bridge** å®ç°äº† Rust å’Œ SeekDB çš„æ— ç¼é›†æˆ
4. **RAG æ¶æ„** å……åˆ†å‘æŒ¥äº†å‘é‡æ£€ç´¢çš„ä¼˜åŠ¿

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… ä¸ªäººçŸ¥è¯†åº“ç®¡ç†
- âœ… ä¼ä¸šæ–‡æ¡£æ£€ç´¢ç³»ç»Ÿ
- âœ… AI è¾…åŠ©ç¼–ç¨‹å·¥å…·
- âœ… å­¦ä¹ ç¬”è®°å’Œç ”ç©¶åŠ©æ‰‹
- âœ… ä»»ä½•éœ€è¦è¯­ä¹‰æœç´¢çš„æ¡Œé¢åº”ç”¨

### 5.3 æœ€ä½³å®è·µå»ºè®®

åŸºäº MineKB çš„å¼€å‘ç»éªŒï¼Œæˆ‘ä»¬æ€»ç»“ä»¥ä¸‹æœ€ä½³å®è·µï¼š

#### æ•°æ®åº“è®¾è®¡

1. **ä¸ºå‘é‡å­—æ®µåˆ›å»º HNSW ç´¢å¼•**
```sql
CREATE VECTOR INDEX idx_embedding 
ON vector_documents(embedding) 
WITH (distance=l2, type=hnsw, lib=vsag);
```

2. **ä¸è¦åœ¨å‘é‡æŸ¥è¯¢ä¸­ SELECT vector å­—æ®µ**
```sql
-- âŒ é”™è¯¯
SELECT embedding, l2_distance(...) FROM ...

-- âœ… æ­£ç¡®
SELECT id, content, l2_distance(...) FROM ...
```

3. **æ·»åŠ é¡¹ç›®è¿‡æ»¤æ¡ä»¶ä»¥æå‡æ€§èƒ½**
```sql
WHERE project_id = ? AND ...
```

#### å‘é‡æ£€ç´¢

1. **å½’ä¸€åŒ–æŸ¥è¯¢å‘é‡**
```rust
let norm = query_embedding.iter().map(|x| x * x).sum::<f64>().sqrt();
let normalized: Vec<f64> = query_embedding.iter().map(|x| x / norm).collect();
```

2. **ä½¿ç”¨ç›¸ä¼¼åº¦é˜ˆå€¼è¿‡æ»¤**
```rust
let threshold = 0.3;
results.retain(|r| r.similarity >= threshold);
```

3. **é™åˆ¶è¿”å›æ•°é‡**
```sql
LIMIT 20  -- ä¸è¦è¿”å›è¿‡å¤šç»“æœ
```

#### åº”ç”¨æ¶æ„

1. **ä½¿ç”¨ Python å­è¿›ç¨‹éš”ç¦» SeekDB**
   - é¿å… Rust FFI çš„å¤æ‚æ€§
   - JSON åè®®ç®€å•å¯é 
   - ä¾¿äºè°ƒè¯•å’Œé”™è¯¯å¤„ç†

2. **å¼‚æ­¥å¤„ç†æ–‡æ¡£ä¸Šä¼ **
   - æ–‡æ¡£å¤„ç†è€—æ—¶è¾ƒé•¿
   - ä½¿ç”¨ Tokio å¼‚æ­¥ä»»åŠ¡
   - å®æ—¶åé¦ˆå¤„ç†è¿›åº¦

3. **æµå¼è¿”å› LLM å“åº”**
   - æå‡ç”¨æˆ·ä½“éªŒ
   - ä½¿ç”¨ Server-Sent Events
   - é€šè¿‡ Tauri Event å‘é€åˆ°å‰ç«¯

### 5.4 æœªæ¥å±•æœ›

MineKB é¡¹ç›®çš„æˆåŠŸéªŒè¯äº† SeekDB åœ¨æ¡Œé¢åº”ç”¨é¢†åŸŸçš„å·¨å¤§æ½œåŠ›ã€‚æœªæ¥æˆ‘ä»¬è®¡åˆ’ï¼š

1. **åŠŸèƒ½å¢å¼º**
   - æ”¯æŒæ›´å¤šæ–‡æ¡£æ ¼å¼ï¼ˆHTMLã€Markdownã€ä»£ç æ–‡ä»¶ï¼‰
   - å®ç°æ··åˆæ£€ç´¢ï¼ˆè¯­ä¹‰ + å…³é”®è¯ï¼‰
   - æ·»åŠ çŸ¥è¯†å›¾è°±åŠŸèƒ½
   - æ”¯æŒå¤šæ¨¡æ€æ£€ç´¢ï¼ˆå›¾ç‰‡ã€éŸ³é¢‘ï¼‰

2. **æ€§èƒ½ä¼˜åŒ–**
   - ä¼˜åŒ–å¤§æ–‡æ¡£çš„å¤„ç†é€Ÿåº¦
   - å®ç°å¢é‡ç´¢å¼•æ›´æ–°
   - æ”¯æŒå¹¶å‘æŸ¥è¯¢

3. **ç”¨æˆ·ä½“éªŒ**
   - æ›´æ™ºèƒ½çš„æ–‡æ¡£åˆ†å—ç­–ç•¥
   - å¯è§†åŒ–æ£€ç´¢ç»“æœç›¸ä¼¼åº¦
   - æ”¯æŒå¯¼å‡ºå¯¹è¯å†å²
   - æ·»åŠ ä¸»é¢˜å’Œä¸ªæ€§åŒ–è®¾ç½®

4. **ç”Ÿæ€å»ºè®¾**
   - å¼€æº MineKB é¡¹ç›®
   - ç¼–å†™è¯¦ç»†çš„å¼€å‘æ–‡æ¡£
   - æ„å»ºæ’ä»¶ç³»ç»Ÿ
   - æ”¯æŒç¤¾åŒºæ‰©å±•

---

## é™„å½•

### A. ç›¸å…³èµ„æº

- **é¡¹ç›®åœ°å€**ï¼šhttps://github.com/ob-labs/mine-kb
- **SeekDB æ–‡æ¡£**ï¼š[docs/SEEKDB_USAGE_GUIDE.md](SEEKDB_USAGE_GUIDE.md)
- **è¿ç§»æŒ‡å—**ï¼š[docs/MIGRATION_SEEKDB.md](MIGRATION_SEEKDB.md)
- **å‡çº§æŒ‡å—**ï¼š[docs/UPGRADE_SEEKDB_0.0.1.dev4.md](UPGRADE_SEEKDB_0.0.1.dev4.md)

### B. æŠ€æœ¯æ ˆé“¾æ¥

- [Tauri](https://tauri.app/) - è·¨å¹³å°æ¡Œé¢åº”ç”¨æ¡†æ¶
- [React](https://react.dev/) - å‰ç«¯ UI æ¡†æ¶
- [Rust](https://www.rust-lang.org/) - ç³»ç»Ÿç¼–ç¨‹è¯­è¨€
- [SeekDB/OceanBase Lite](https://www.oceanbase.com/) - AI-Native åµŒå…¥å¼æ•°æ®åº“
- [é˜¿é‡Œäº‘ç™¾ç‚¼](https://www.aliyun.com/product/bailian) - LLM å’Œ Embedding æœåŠ¡

### C. å¸¸è§é—®é¢˜

**Q: SeekDB é€‚åˆå¤„ç†å¤šå¤§è§„æ¨¡çš„æ•°æ®ï¼Ÿ**

A: åŸºäºæµ‹è¯•ï¼ŒSeekDB å¯ä»¥è½»æ¾å¤„ç†ï¼š
- 10 ä¸‡ä¸ªæ–‡æ¡£å—ï¼ˆçº¦ 1GB æ–‡æœ¬ï¼‰
- 1536 ç»´å‘é‡
- æ£€ç´¢å»¶è¿Ÿ < 50ms

**Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ**

A: ç›´æ¥å¤åˆ¶æ•°æ®åº“ç›®å½•ï¼š
```bash
cp -r ~/Library/Application\ Support/com.mine-kb.app/mine_kb.db ~/backup/
```

**Q: å¯ä»¥è¿ç§»åˆ°äº‘ç«¯å—ï¼Ÿ**

A: å¯ä»¥ï¼æ•°æ®å¯ä»¥è¿ç§»åˆ° OceanBase åˆ†å¸ƒå¼ç‰ˆï¼Œå®ç°äº‘ç«¯éƒ¨ç½²ã€‚

**Q: æ”¯æŒ GPU åŠ é€Ÿå—ï¼Ÿ**

A: å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒã€‚å‘é‡è®¡ç®—åœ¨ CPU ä¸Šå·²ç»è¶³å¤Ÿå¿«ã€‚

---

**æ–‡æ¡£ç»“æŸ**

æ„Ÿè°¢é˜…è¯»ï¼å¸Œæœ›è¿™ä»½æ•™ç¨‹èƒ½å¸®åŠ©ä½ ç†è§£ MineKB çš„å¼€å‘è¿‡ç¨‹ï¼Œå¹¶å¯å‘ä½ ä½¿ç”¨ SeekDB æ„å»ºè‡ªå·±çš„ AI-Native æ¡Œé¢åº”ç”¨ã€‚

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æäº¤ Issue æˆ– Pull Requestã€‚

---

**ç‰ˆæƒå£°æ˜**ï¼šæœ¬æ–‡æ¡£åŸºäº MineKB é¡¹ç›®ç¼–å†™ï¼Œéµå¾ªé¡¹ç›®å¼€æºåè®®ã€‚

**ä½œè€…**ï¼šMineKB Team  
**æ—¥æœŸ**ï¼š2025-11-05  
**ç‰ˆæœ¬**ï¼š1.0
